{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% block content %}
<div class="container">
<br>
<h3>Create Your  Spare Dealer Profile</h3>
<hr>
<form method="post">
{% csrf_token %}
    <div class="form-group">
        {{ form.first_name|as_crispy_field }}
    </div>
    <div class="form-group">
        {{ form.last_name|as_crispy_field }}
    </div>
    <div class="form-group">
        {{ form.phone_number|as_crispy_field }}
    </div>
    <div class="form-group">
        {{ form.store|as_crispy_field }}
    </div>
    <div class="form-group">
        {{ form.description|as_crispy_field }}
    </div>
    <div class="form-group">
        {{ form.photo|as_crispy_field }}
    </div>
    <button type="submit" class="btn btn-light btn-lg btn-block" style="background-color:#D02222 !important; color:white;">Save</button>
</form>
</div>
<br>
{% endblock %}

{% block footer %}
{% endblock footer %}

<script>
  const categoryInput = document.querySelector("select#id_category")
  const subcategoryInput = document.querySelector("select#id_sub_category")

  categoryInput.onchange = function (e) {
    getAndSetSubcategories(e.target.value)
  }

  function getAndSetSubcategories(category) {
    let subCatReq = new XMLHttpRequest()

    subCatReq.addEventListener("load", function (e) {
      let subcategories = JSON.parse(e.target.response)

      // Map the list of subcategory objects to a list of options
      subcategories = subcategories.map(function (subcategory) {
        return `<option value="${subcategory.pk}">${subcategory.fields.name}</option>`
      })

      // Add default option to start of the array
      subcategories.splice(0,0,'<option value="" selected="">---------</option>')

      subcategoryInput.innerHTML = subcategories.join(" ")
    })

    subCatReq.open("GET", `{% url 'sparedealers:get_subcategories' %}?category=${category}`)
    subCatReq.send()
  }
</script>